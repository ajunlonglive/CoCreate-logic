!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.CoCreateLogic=e():t.CoCreateLogic=e()}(this,function(){return n={},i.m=a=[function(t,e){function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var n={init:function(){this.__initKeys(),this.__initPassSessionIds(),this.__initPassParams(),this.__initPassValueParams(),this.__initGetValueInput(),this.initAtagElement()},__initKeys:function(){localStorage.getItem("apiKey")&&(config.apiKey=localStorage.getItem("apiKey")),localStorage.getItem("securityKey")&&(config.securityKey=localStorage.getItem("securityKey")),localStorage.getItem("organization_id")&&(config.organization_Id=localStorage.getItem("organization_id"))},__initPassSessionIds:function(){var t=localStorage.getItem("organization_id"),e=localStorage.getItem("user_id"),a=localStorage.getItem("adminUI_id"),n=localStorage.getItem("builderUI_id");this.__initPassItems(t,".sessionOrg_Id",!0),this.__initPassItems(e,".sessionUser_Id"),this.__initPassItems(a,".sessionAdminUI_Id"),this.__initPassItems(n,".sessionBuilderUI_Id")},initElement:function(t){var i,s=this,e=t||document;e.querySelectorAll&&(t=e.querySelectorAll("[data-pass_id]"),t=Array.from(t),e!=document&&e.hasAttribute("data-pass_id")&&t.push(e),i=localStorage.getItem("dataParams"),(i=JSON.parse(i))&&0!=i.length&&t.forEach(function(t){var e,a,n;CoCreateObserver.getInitialized(t)||(e=t.getAttribute("data-pass_id"),(a=i.find(function(t){return t.pass_to==e}))&&(n=a.collection,a.document_id,a.pass_to,a.prefix,CoCreateObserver.setInitialized(t),"FORM"===t.tagName&&!t.getAttribute("data-colleciton")&&n&&t.setAttribute("data-colleciton",n),s.__setPassAttributes(t,a)))}))},initAtagElement:function(){var i=this;document.addEventListener("click",function(t){var e=t.target.closest("a, button");if(e){if("modal"===e.getAttribute("target")&&e.getAttribute("data-pass_to"))return t.preventDefault(),void i.setLinkProcess(e);var a,n=e.getAttribute("href");"modal"!==e.getAttribute("target")&&(e.hasAttribute("data-actions")||i.passSubmitProcess(e)&&(a=e.getAttribute("data-pass_to"),n?(t.preventDefault(),i.storePassData(e),i.openAnother(e)):(i.storePassData(e),a&&i.__initPassParams(a))))}})},__initPassParams:function(t){var s,e=localStorage.getItem("dataParams");(e=JSON.parse(e))&&0!=e.length&&(s=this,e.forEach(function(a){var n=a.collection,i=(a.document_id,a.prefix,a.pass_to);t&&i!=t||(document.querySelectorAll("form").forEach(function(t){var e=t.getAttribute("data-pass_id");e&&e==i&&n&&""!=n&&(t.getAttribute("data-collection")||t.setAttribute("data-collection",n))}),document.querySelectorAll("[data-pass_id]").forEach(function(t){var e=t.getAttribute("data-pass_id");e&&e==i&&s.__setPassAttributes(t,a)}))}))},__initPassValueParams:function(t){var e=localStorage.getItem("valueParams");(e=JSON.parse(e))&&0!=e.length&&e.forEach(function(a){var n=a.pass_value_to;(t||document).querySelectorAll("[data-pass_value_id]").forEach(function(t){var e=t.getAttribute("data-pass_value_id");e&&e==n&&(["INPUT","TEXTAREA","SELECT"].includes(t.tagName)?(t.value=a.value,CoCreateFloatingLabel&&CoCreateFloatingLabel.update(t)):t.innerHTML=a.value)})})},__getPassAttributes:function(t){return{collection:t.getAttribute("data-pass_collection")||t.getAttribute("data-pass_fetch_collection"),document_id:t.getAttribute("data-pass_document_id"),name:t.getAttribute("data-pass_name"),value:t.getAttribute("data-pass_value"),pass_to:t.getAttribute("data-pass_to"),filter_name:t.getAttribute("data-pass_filter_name"),filter_value:t.getAttribute("data-pass_filter_value"),prefix:t.getAttribute("data-pass_prefix")||""}},__setPassAttributes:function(t,e){var a=e.collection,n=e.document_id,i=e.name,s=e.value,o=e.pass_to,r=e.filter_name,u=e.filter_value,l=e.prefix,c=t.getAttribute("data-pass_id"),e=!!t.hasAttribute("data-pass_refresh");c==o&&(a&&(this.__setAttributeValueOfElement(t,"data-collection",a,e),this.__setAttributeValueOfElement(t,"data-fetch_collection",a,e),this.__setAttributeValueOfElement(t,"data-pass_fetch_collection",a,e),this.__setAttributeValueOfElement(t,"data-pass_collection",a,e)),n&&(this.__setAttributeValueOfElement(t,"data-document_id",n,e),this.__setAttributeValueOfElement(t,"data-fetch_document_id",n,e),this.__setAttributeValueOfElement(t,"data-pass_fetch_document_id",n,e),this.__setAttributeValueOfElement(t,"data-pass_document_id",n,e)),i&&(this.__setAttributeValueOfElement(t,"name",i,e),this.__setAttributeValueOfElement(t,"data-fetch_name",i,e),this.__setAttributeValueOfElement(t,"data-pass_name",i,e)),s&&(this.__setAttributeValueOfElement(t,"value",s,e),this.__setAttributeValueOfElement(t,"data-pass_value",s,e)),l&&(this.__setAttributeValueOfElement(t,"name",l+t.getAttribute("name"),e,!0),this.__setAttributeValueOfElement(t,"data-fetch_name",l+t.getAttribute("data-fetch_name"),e,!0),this.__setAttributeValueOfElement(t,"data-pass_prefix",l,e)),r&&(this.__setAttributeValueOfElement(t,"data-filter_name",r,e),this.__setAttributeValueOfElement(t,"data-pass_filter_name",r,e)),u&&(this.__setAttributeValueOfElement(t,"data-filter_value",u,e),this.__setAttributeValueOfElement(t,"data-pass_filter_value",u,e)))},__setAttributeValueOfElement:function(t,e,a,n,i){!a||(t.hasAttribute(e)&&i||t.hasAttribute(e)&&(!t.getAttribute(e)||n))&&t.setAttribute(e,a)},storePassData:function(t){var e=[],a=this,n=this.__getPassAttributes(t);t.hasAttribute("data-actions")||(n.pass_to&&e.push(n),t.querySelectorAll("[data-pass_to]").forEach(function(t){t=a.__getPassAttributes(t);t.pass_to&&e.push(t)}),0<e.length&&localStorage.setItem("dataParams",JSON.stringify(e)))},__initValuePassBtns:function(){},__initGetValueInput:function(){for(var t=document.querySelectorAll("input, textarea"),e=this,a=0;a<t.length;a++){var n=t[a];n.id&&(n.addEventListener("input",function(t){e.__setGetValueProcess(this.id,this.value)}),n.addEventListener("updated_by_fetch",function(t){e.__setGetValueProcess(this.id,this.value)}))}},__registerValuePassBtnEvent:function(t,e){},passProcessAction:function(t){var a,t=t.closest("form");t&&(t=t.querySelectorAll("input, textarea, select"),a=[],t.forEach(function(t){var e=t.getAttribute("data-pass_value_to"),t=t.value;e&&a.push({pass_value_to:e,value:t})}),0<a.length&&localStorage.setItem("valueParams",JSON.stringify(a)),this.__initPassValueParams(),document.dispatchEvent(new CustomEvent("passValueActionEnd",{detail:{}})))},setDataPassValues:function(t){var e,a=[];for(e in t)a.push({pass_value_to:e,value:t[e]});0<a.length&&localStorage.setItem("valueParams",JSON.stringify(a))},initDataPassValues:function(){localStorage.removeItem("valueParams")},openAnother:function(t){var e=t.getAttribute("href"),t=t.getAttribute("target");"_blank"==t?window.open(e,"_blank"):"_window"==t?window.open(e,"_blank","location=yes,height=570,width=520,scrollbars=yes,status=yes"):window.open(e,"_self")},setLinkProcess:function(t){var e,a;t.hasAttribute("data-actions")||(e=t.getAttribute("data-pass_to"),a=t.getAttribute("href"),this.storePassData(t),this.checkOpenCocreateModal(t)?CoCreateModal&&CoCreateModal.open(t):a?this.openAnother(t):e&&this.__initPassParams(e))},checkOpenCocreateModal:function(t){return"modal"===t.getAttribute("target")},passSubmitProcess:function(t){return!t.parentNode.classList.contains("submitBtn")||!(!t.getAttribute("data-pass_to")||!t.getAttribute("data-pass_document_id"))},__setGetValueProcess:function(t,a){t&&document.querySelectorAll('[data-get_value="'+t+'"]').forEach(function(t){var e;void 0!==t.value?t.value=a:void 0!==t.textContent&&(t.textContent=a),CoCreateFloatingLabel&&CoCreateFloatingLabel.update(t),t.dispatchEvent(new Event("input",{bubbles:!0})),t.classList.contains("searchInput")&&(e=new KeyboardEvent("keydown",{keyCode:13}),t.dispatchEvent(e))})},__initPassItems:function(e,t,a){var n=this;e&&document.querySelectorAll(t).forEach(function(t){n.__setAttributeValueOfElement(t,"data-document_id",e),n.__setAttributeValueOfElement(t,"data-filter_value",e)})}},i={mainInfo:{},init:function(){var e=this;CoCreateSocket.listen("updateDocument",function(t){e.render(t)}),CoCreateSocket.listen("readDocument",function(t){e.render(t)}),CoCreateSocket.listen("connect",function(t){e.__getRequest()})},initElement:function(t){t=this.__getRequest(t);t&&t.forEach(function(t){CoCreate.readDocument({collection:t.collection,document_id:t.document_id})})},render:function(n){var t,i=this,s=n.collection,o=n.document_id;for(t in n.data)!function(t){var e=i.__makeKey(s,o,t),a=n.data[t];i.mainInfo[e]&&i.mainInfo[e].forEach(function(t){t.el.setAttribute(t.attr,a),t.el.dispatchEvent(new CustomEvent("CoCreateAttribute-run",{eventType:"rendered",item:t.el}))})}(t)},setValue:function(t,e){},__getRequest:function(t){var e=t||document,t=e.querySelectorAll("[fetch-for]"),_=this,d=[];return(t=0===t.length&&e!=document&&e.hasAttributes("fetch-for")?[e]:t).forEach(function(i){for(var s=i.getAttribute("data-collection"),o=i.getAttribute("data-document_id"),r=i.getAttribute("name"),u=(i.getAttribute("value"),i.attributes),l=0;l<u.length;l++){var c=_.__jsonParse(u[l].value);c&&function(){var e=c.collection||s,a=c.document_id||o,t=c.name||r;c.value,c["data-pass_id"]&&((n=_.__checkPassId(c["data-pass_id"]))?(e=n.collection,a=n.document_id,n.value):a=e=null);var n=_.__makeKey(e,a,t);e&&a&&t&&(_.mainInfo[n]||(_.mainInfo[n]=[]),_.mainInfo[n].push({el:i,attr:u[l].name}),d.some(function(t){return t.collection===e&&t.document_id===a})||d.push({collection:e,document_id:a}))}()}}),d},__jsonParse:function(t){try{var e=JSON.parse(t);return"object"===a(e)&&null!=e?e:null}catch(t){return null}},__checkPassId:function(t){var e=localStorage.getItem("dataParams");if(!(e=JSON.parse(e))||0==e.length)return null;for(var a=0;a<e.length;a++)if(e[a].pass_to==t)return{collection:e[a].collection,document_id:e[a].document_id,value:e[a].value};return null},__makeKey:function(t,e,a){return"".concat(t,"_").concat(e,"_").concat(a)}};i.init(),n.init(),CoCreateObserver.add({name:"CoCreateAttributes",observe:["subtree","childList"],include:"[data-for]",task:function(t){i.initElement(t.target)}}),CoCreateObserver.add({name:"CoCreateLogic",observe:["subtree","childList"],include:"[data-pass_id]",task:function(t){n.initElement(t.target)}}),CoCreateAction.registerEvent("passValueAction",n.passProcessAction,n,"passValueActionEnd")}],i.c=n,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(a,n,function(t){return e[t]}.bind(null,n));return a},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0).default;function i(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return a[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}var a,n});