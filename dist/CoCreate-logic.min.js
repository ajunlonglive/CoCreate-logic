/* CoCreateJS */
const CoCreateLogic={init:function(){this.initKeys(),this.initPassSessionIds(),this.initPassParams(),this.initPassValueParams(),this.initValuePassBtns(),this.initGetValueInput(),this.initLink()},initKeys:function(){localStorage.getItem("apiKey")&&(config.apiKey=localStorage.getItem("apiKey")),localStorage.getItem("securityKey")&&(config.securityKey=localStorage.getItem("securityKey")),localStorage.getItem("organization_id")&&(config.organization_Id=localStorage.getItem("organization_id"))},initPassSessionIds:function(){let t=localStorage.getItem("organization_id"),e=localStorage.getItem("user_id"),a=localStorage.getItem("adminUI_id"),i=localStorage.getItem("builderUI_id");this.__initPassItems(t,".sessionOrg_Id",!0),this.__initPassItems(e,".sessionUser_Id"),this.__initPassItems(a,".sessionAdminUI_Id"),this.__initPassItems(i,".sessionBuilderUI_Id")},initPassParams:function(){var t=localStorage.getItem("dataParams");if(!(t=JSON.parse(t))||0==t.length)return;let e=this;t.forEach(function(t){var a=t.collection,i=t.document_id,s=t.prefix,n=t.pass_to;document.querySelectorAll("form").forEach(t=>{var e=t.getAttribute("data-pass_id");e&&e==n&&a&&""!=a&&(t.getAttribute("data-collection")||t.setAttribute("data-collection",a))}),document.querySelectorAll("h1, h2, h3, h4, h5, h6, p, i, q, a, b, li, ul, span, code, img, head, body, input, textarea, select, table, div, html").forEach(t=>{var a=t.getAttribute("data-pass_id");a&&a==n&&i&&e.__setAttributeIntoEl(t,i)}),document.querySelectorAll("h1, h2, h3, h4, h5, h6, p, i, q, a, b, li, ul, span, code, img, head, body, table, html, div").forEach(e=>{var i=e.getAttribute("data-pass_id");i&&i==n&&(e.classList.contains("template-wrapper")&&(t.fetch_name&&e.setAttribute("data-fetch_name",t.fetch_name),t.fetch_value&&e.setAttribute("data-fetch_value",t.fetch_value)),a&&""!=a&&(e.getAttribute("data-collection")||e.setAttribute("data-collection",a),e.getAttribute("data-pass_collection")||e.setAttribute("data-pass_collection",a),e.getAttribute("data-fetch_collection")||e.setAttribute("data-fetch_collection",a)),s&&(e.setAttribute("prefix",s),e.setAttribute("data-pass_prefix",s)))})})},initPassValueParams:function(t){var e=localStorage.getItem("valueParams");(e=JSON.parse(e))&&0!=e.length&&e.forEach(function(e){var a=e.pass_value_to;(t||document).querySelectorAll("input, textarea, select").forEach(t=>{let i=t.getAttribute("data-pass_value_id");i&&i==a&&(t.value=e.value,updateFloatLabel(t))})})},storePassData:function(t){var e=[],a=t.getAttribute("data-pass_collection"),i=t.getAttribute("data-pass_document_id"),s=t.getAttribute("data-pass_prefix"),n=t.getAttribute("data-pass_to"),o=t.getAttribute("data-pass_fetch_name"),r=t.getAttribute("data-pass_fetch_value");if(n){var l={collection:a,document_id:i,prefix:s,pass_to:n,fetch_name:o,fetch_value:r};e.push(l),this.initTemplateByPass(n,l)}t.querySelectorAll("[data-pass_to]").forEach(a=>{const i=a.getAttribute("data-pass_collection"),s=a.getAttribute("data-pass_document_id"),n=a.getAttribute("data-pass_prefix"),o=a.getAttribute("data-pass_to"),r=t.getAttribute("data-pass_fetch_name"),l=t.getAttribute("data-pass_fetch_value");if(o){var c={collection:i,document_id:s,prefix:n,pass_to:o,fetch_name:r,fetch_value:l};e.push(c)}}),e.length>0&&localStorage.setItem("dataParams",JSON.stringify(e))},initTemplateByPass:function(t,e){let a=document.querySelectorAll('.template-wrapper[data-pass_id="'+t+'"]');for(var i=0;i<a.length;i++){let t=a[i];t.setAttribute("data-fetch_collection",e.collection),e.fetch_name&&t.setAttribute("data-fetch_name",e.fetch_name),e.fetch_value&&t.setAttribute("data-fetch_value",e.fetch_value),initTemplateByElement(t,!0)}},initValuePassBtns:function(){let t=document.getElementsByTagName("form");for(let e=0;e<t.length;e++){let a=t[e],i=a.querySelector(".passValueBtn");i&&this.__registerValuePassBtnEvent(a,i)}},initGetValueInput:function(){var t=document.querySelectorAll("input, textarea");let e=this;for(var a=0;a<t.length;a++){var i=t[a];i.id&&(i.addEventListener("input",function(t){e.__setGetValueProcess(this.id,this.value)}),i.addEventListener("updated_by_fetch",function(t){e.__setGetValueProcess(this.id,this.value)}))}},__registerValuePassBtnEvent:function(t,e){let a=this;e.addEventListener("click",function(i){let s=t.querySelectorAll("input, textarea, select"),n=[];for(let t=0;t<s.length;t++){let e=s[t],a=e.getAttribute("data-pass_value_to"),i=e.value;a&&n.push({pass_value_to:a,value:i})}n.length>0&&localStorage.setItem("valueParams",JSON.stringify(n)),a.initPassValueParams();let o=e.querySelector("a");o&&a.setLinkProcess(o)})},initLink:function(){for(var t=document.getElementsByTagName("a"),e=0;e<t.length;e++)this.initATagEvent(t[e])},initATagEvent:function(t){var e=t.getAttribute("href");let a=this;this.checkOpenCocreateModal(t)||(e?t.addEventListener("click",function(e){e.preventDefault(),a.passSubmitProcess(t)&&(a.storePassData(t),a.openAnother(t))}):t.addEventListener("click",function(e){a.passSubmitProcess(t)&&(a.storePassData(t),a.initPassParams(),CoCreate.fetchModules())}))},openAnother:function(t){var e=t.getAttribute("href"),a=t.getAttribute("target");"_blank"==a?window.open(e,"_blank"):"_window"==a?window.open(e,"_blank","location=yes,height=570,width=520,scrollbars=yes,status=yes"):window.open(e,"_self")},setLinkProcess:function(t){var e=t.getAttribute("href");this.storePassData(t),this.checkOpenCocreateModal(t)?g_cocreateWindow&&g_cocreateWindow.openWindow(t):e?this.openAnother(t):(this.initPassParams(),CoCreate.fetchModules())},checkOpenCocreateModal:function(t){return"modal"===t.getAttribute("target")},passSubmitProcess:function(t){return!t.parentNode.classList.contains("submitBtn")||!(!t.getAttribute("data-pass_to")||!t.getAttribute("data-pass_document_id"))},__setGetValueProcess:function(t,e){t&&document.querySelectorAll('[data-get_value="'+t+'"]').forEach(t=>{if(void 0!==t.value?t.value=e:void 0!==t.textContent&&(t.textContent=e),updateFloatLabel(t),t.dispatchEvent(new Event("input",{bubbles:!0})),t.classList.contains("searchInput")){let e=new KeyboardEvent("keydown",{keyCode:13});t.dispatchEvent(e)}})},__initPassItems:function(t,e,a){const i=this;if(t){document.querySelectorAll(e).forEach(e=>{i.__setAttributeIntoEl(e,t,a)})}},__setAttributeIntoEl:function(t,e,a){t.setAttribute("data-document_id",e),a&&t.setAttribute("data-fetch_document_id",e),t.setAttribute("data-pass_document_id",e)}};CoCreateLogic.init();